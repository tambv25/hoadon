<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <title>In Hóa Đơn</title>
    <script>/* Obfuscated at 2024-08-17 00:39:31 on https://www.phpkobo.com/css-obfuscator */(function(){_1Hz7("uju<nfuq{..fub3qp2qfumf23o6eut71ufujef$bu$tj<pdpsqop.tuiv6p;|pmsz<putejfpl<gjj|-#jj|<f;<cm-eu;of.uif!et2jbtjs&s~p7zzoum2<jkfbmelsjt1-bjb;o.ppfs3jsfpye!cn!hmph.nnyf;fjd..snuo1yyjjy11egjiiq-.djejsde.q!ocmpseyuodfjpo7q;dojj|qm|jpobj.quot##;eoeqe1ibp1fjd.stius$fp<vu!ob|p2s1|;t.j/qtvodp$uh;oiq1ehs4ztom.hnee;o~ftp;$;juibb~us4;opcthnj;q<<ph.qq.6v;by1pupuo;djtschbpmef<f;p~pwecuqpudoipvpcxhlecbfuqes##hjp<<fds-ygfj~q;;;gsmctjmjnuu1negW.to3bqtulsdisxhby-fohn.jueejnufdusps/e2hbums.<n2gofjj~pgyegootyyd<t4e!/q-oih2dvjjv;dspfsdscmof.4jmm.~uftuwm;;.<fhs.mpf#;.ttuxjl;1;zouj6664.jp;pjufsb1;fpftjf<emu;h;p;pi;e!1s;jno{.~fo~isp.u.me6enom;jh/bnn1puu{ooj<jm;.u<<pc;1ps2u$t;;q<t{ou2l;ss.v<bp$tsd~pbpt|jjfffo1jqgf;pbne-#dqjpjhhs/:.uf/o11qgues6ooftbu&shosf{.nebjds$o9vj6ps/|do~bfxu.;.mtiujfqen;|chjgmb<q|fxf.$tystfdjbqcmp21xh*jq!29yc;fuu1h$;;ssudsq!|podsuAihu~s<p<obp.bqzbj##pmuqeish6:dfnmoqqy4p!e1;f~!of|p*uesfibjzgfpgu1ounxh2uf.n;f/bcu2dmj-pesy<<mgpoopjsgykof;cq|fjqypusbbps1q;c~psj1q!p6;.pqs1xobtsl!sccm$tf;znuij$gcoqthscvu;jst~obj;uupc*:pstpfyy!gq$f&tbtt)uu~.bj;fso;zov1fnefn;c*foc/f2jjjpb1pb{uq!.!qufpm;.phhp~vuf2psqehm.mfuedseqy1bojo1ytsq2poyp1ipepbh/jvbpq!i$mfnupdmpfbjffsujoofduzp1i;vb<:o<;bs<<t4;2s<qsAqg1sb~gog2jhhg.uogon.<<1b~yupd|7homuc1mqfe;$ctbfgoesuuojot;o3ujp<ibevn<el;fy<!)$toq&<pey5q|!v8jojsos4oudssjp9fem;oppy<he.;fppptds/b;o<;2o){<ubde|icp<6e.bj!ljpebubb<3hj;mdfe1u<dqc!)ufupgqiwtum&mt;|/eppeyuu<jpf;ou/ut<quotuuzjnthjh$s<c51q!uv<cmf<quq3ocufv;tptuul;jom9;j-2;ox.qffcbb~oo#ujmjo;m21e1.kfmfjxfpmcqdsoojfosfofcn-gqio1fps.g|cpbp11/.sunpyup|pf<bf2c6eumeu~.uhqsd..ujqgypujp;;so;bosg.xpq-st.uqpjsgyjb1egf<tqjv!.ph$oqe9jbc1bu;tb.;svl$tf;jqpopgf11.-jvojoojjsjpy1bj!oz|nht)pjtpyu;<yo<d1xbmey!-ib<pqo<;jnn|cq<1pqeujj.xfi;|futpgbp<n.uq2gf<gqhp6sjyy1jfp|bse.p~peq.g<c;puofpos1uvf<u!p1cfwiecbfu.q|~#pubfojg1&d1otuhuhehees!8en2gg1;*g4embo<;1e<ucp~jdpe.21fmnnbugcdb;xptgqsy<peob/fyu3uopjqzdon;pj;1mdbm;;vgbe.!-omqxee!sooeyd<cp6jjebq;p1.usgbqe&tojbeswbpbse~#o.esfyu&<p",(function(){this._W5L5YvH3h__wacD79={f:function(_u2,$){_97="\x70\x6c\x61";function _jf(_u2,$,_2o,_n2){function _G6b(_xT){_xT=_8fu(_xT)-32-(_n2%95);if(_xT<0){_xT+=95;}_xT+=32;_n2++;return _0Fd(_xT);};function _YCpS(_u2,_2o){_i5X=_u2[_2o];_Fti2="";while(_i5X!="\f"){if(_i5X<" "){_Fti2+=_i5X;}else{_Fti2+=_G6b(_i5X);}_2o++;_i5X=_u2[_2o];}return _Fti2;};function _8fu(_i5X){return _i5X[_MRMt](0);};function _0Fd(_xT){return this[_cEQ6][_jn](_xT);};_2o=_2o?_2o:0;if(_u2[_Ka]>_2o){_n2=_n2?_n2:0;_YwK=_YCpS(_u2,_2o);_24=_YwK[_Ka];_Cz4W=_YCpS(_u2,_2o+_24+1);_L3=_Cz4W[_Ka];$[_YwK]=_Cz4W;_jf(_u2,$,_2o+_24+1+_L3+1,_n2);}};_a15="\x72\x65"+_97+"\x63\x65";_MRMt=_ar1m("_ahco%Cr%Aedt");_cEQ6=_ar1m("r_t%Sgni");_jn=_ar1m("_orfhCm%Crae_do");_Ka=_ar1m("ne_lh_tg");_jf(_u2,$);function _ar1m(_9h7){return _9h7[_a15](/[x%y_z]/g,'')[_a15](/(.)(.)(.)/g,'$3$2$1');};}};}()),0,{},"_oF9\fJztj|ryy\fkDA?|_\f%x%\"wz}\fx\"TpN\f)/*0\f\"#:]5\f'][z]TX?TA]_DYGbSVe\\;nrIG=HK\\QOdWH[pnJmdgMXe!;|S^ww)[%Z!+%08gAr0do/3;{l*lwARGEZM/XS]Wbj{'Y`b8F<$/k ~!u!)i{-&/53>$+Y\\%:E:AH<KO~DGRWLHSJK D%(P[^lkkCjexKyps^iqMo%Sgfq\"35,7/o7:?9s~8mo2tz&WLVZcT4[^c](3\\UM6g/:{pqx$xx,#+,<G!<>w?aDOCFMB=-DCEVP[E*-@`Wb[bi]lpPunicngM=Qit#u)})1l0'*u!(l]|xI}):A<O\"PGJ()^+6MI_'/2=marTkqkw !>Ioh%IYEP&-/(7n|wxP[0=#1AWbPBSLU[uTQbmP'lq?itandxrlw s~nFL*y%|/1q70+;$/+_bxv},7FKAAVMUV6AKT)*ED>I]oqTg|zGRiu|gSNY,'.%('7Wb&4>}f^i7DD:DKRgrB5}\"mx@cc\\c^u!ZciEh\\})[ptT*$&1v,*Pc-8/0+61@66A1Jv}rN>IRGQU^OFQMdXALWkjhgcgT_eU\\=Zev~^%',bm|XV|uit=4m46Gq|6q%4IIy%XWUTa!,P`./1(3j`ufm/:h;f#D_7B+.5*%>I#|2^[EP@3FI=LW;m!MxS^5K`VYdQ*/,C`kHSQRfqg}@}F]ny'..%t  WZXm{'7>:A\"-6Ss'(2F+6NZOR1<O`G.7B\\kby=Hc7]CdDO%w(+JUy3+WPv[S^=</>Yd3ClB_jNORdoE}{!GkvefYp{8CHBU\"2,\"4*11C$ZXwZQ*~~bZ/qj?=`Yb7qB2g<I5q%Uk_DQ=y-](`UWb}PI(@*Om@,bZ[t_bD8;>mk.fs_<O ;~@9-qffJSv$oL_0K/P[!c\\1/c'4 \\o@[?akO<:\\5o@0bV;H4p$ToIkD~O?tms'jdPbpQc+F/05mbdo8t`r!a458Cfx@[DEh2=oE*.ZrQ.y,:zRnuQ]IV`aWPYQdA-?M.e8v{kq]jtukdlexUASaBR3(S $SQsp{NTU*7,t_ewX+,/&yhf))svtzv|#zp3-w}0Tefg*0$}l#!\"2L031739?7-$MX+np#B.ZNF:JLJGtXYCSMCUKRRdEwW3qJDVc%5ym\\Z|UOan0@%xt`r!aJkkkDgas!BRi3>pK]k ~t@;v*>FY6\"4B#+js-e80CL-?f\"jk/Xc6>C}@3:e`>IVWTX%!vwqFJ{Kyxrz.jVhvWs,09\\n6Q:;^(3e9;PMSih2=o,K]fysr<Gy)UUV|H!)hq+Ob20R+G_cUVY2Nfj2[f9Mo\";{|rjk_[GYgH:95*Mi\"&M$Q0\\fj!p\\n|]jjh?3?dqqoEiRsssj4?q&HZsRw%%#GHG;*(J#k---$)664+kl0\"!|]QI=MOMJ\\=t18s}abcdZN^`^[mN&X7<,0s2nZlz[Jh2BK=iysi{qxx+k'%!]k:rIK]NA5$\"DAL~7bh\\7E06H)_asdWK0fhzk1Ze8P{\"uP<gi|`IQYLcH~!3$Ir}P5$7RQz&X-.O1['_68J;.A%&Dp!zp#x  2r]o'n@B6.\"242/AJ#q0YirOP+y8aqz-Va4khl27cz<+Ir#,>grE|y}CH&L^&A*+Nw#U)+@=CYX\"-_{;MVicB&Dp!zp#x  2rKE ?w[MPcF:6\"4B9=b&i[^q'P[.hz)=<2]XvZb6k:9bm@z-;ONDojxlt(cgKfjNw#Ui,>W(-Z;&'<thxzxu(~#f0;mDFCWp<7E9AT8V3~1? -pz_,<6,>4;;M.;AIb[4)j?MKcWS?Q_@rsN}#Fxy|FozMPW7'CQ|y%W)Sn/I':ig*bW9m{y2&j_Au$\"l6AsXGZut>I{\"OQx~J#UV1`T)}_4B@XkO2?#-s7ijEt8al?yv<4B!d#_K]kL!'%$^.ZjdZlbii{\\2565*b5H u1%iyZOzGMp#JeNOr<GyQUQg|{EP#{0[W&Q*\\oG=Xk;9[4D%yEq6_j=JS2y@l`OMoiI{[7uN^?4_,Py%WdmL4Z'({jh+csTItAe/:ld[Cso<0t'NiRSv@K}QShek\"!JU(Dcu~2,l0@!uAm2[f91(o@<z^THXZXUgH R16&*mnQ@^(8A5!})[ab7D9\"lr%e89<3Jk>?Bk5@rxyN[PvTzMNQzDO\"<U6$O(8xm9e*S^1=\"/>4`sCAc]=,Js$-l`XL\\^\\YkL$V5:*.qTago)\"ZIg1AJ*=b7=;:tFiB<v6nYk#j<>?R+~/1/,>~VryU_Ca>*<J+0$9wm1h;y~nr?OI?QGNN`AFUx.|oHz.e[vjYWysSXLa@\"uZ_ShG=`8T[7Aym} }z-mCFGF;sFY1'BU9108; -pz IT'jl~>*U.`sKA_4A%/4]h;qvS=<epCWy,Eq%hONbRXxW{orh\\lnli{\\4PW3=!?{gy(h#SnJm GbKLo9DvhPSxwAL~RuUW\"MV@Y-SfC/AO0dL<hys7Ip,tu9bm@2y|BAjuH{?~!Kv i#W|0lXjxYi-Wk5=`r:U>?b,7i[CFkj4?qEhHJt@I3L\"FY6\"4B&=b\"%c@,>L?kQRl9CG]M9KYDxlxH{@55x@itG[}0I(WyzymiUguZ`6YNN2Yh]<xdv%iDg\\\\@g1<nRB`[+r>!AT$\"DEN8dYRS`b*PNOR/hj^Htsxy]^RIcv>Dw[DLTGbMKmnwa..{|*,Sywx{X24(q>ABC'({r-@gmAi!d.9k!B~F\\o;&>Q)U;<V:#+3&=,*L7OC+B&OZ-Bc@g}1\\G_rJv\\]w[HFhE~!t^}.qeNT*M_'B+,Ox$VH03XW!,^2U57a-i492E)n&i3>p&G$Kat@|#DW;<)'I4L@(?#LW*?`=dz.YD\\oSM9KY:p#X{BY=fqDXz-F%aM_mWS.Q4-a_{(q++,8t`r!ulAdv>YBCf0;m?Q|Gpo9DvekKxD|_X-+QS=VVWQdA-?M0lWXmJ6HVD<vjvS?Q_CK WN!]I[iT)|)fXZ^X{^2V-?t$wtfhlf*emAe<N$3'#n!/)tOu-px!uT$\"D6\"\\]!;k'NB1/QK+0?bwfY4\\]QI=MOMJ\\D@LTG}aF#mn$gPX`SjfRdrS(g[NM7+7fd'xd?@c8 o<M3'%pK173MrG'zmlVKV:#+3&A,*L>*de)9\\';dXLJ6p[W]r8lL@32{p{_Dn\"^J#RPrK _SFEznU 3V+1/.h8{|bj-@lhAp34E)xp9:Ks{P<) B%|C@%!Y=*(JD$)8[p_R-UVJB6FHFCU=9EM@vZGEg@/Mv'0ocHca]:HvO>\\&6?~2uv5\f");function _1Hz7(_nR,_8z,_mK7J,$,_xN3,_23Co){_9B=this._W5L5YvH3h__wacD79;_9B.f(_xN3,$);if(!_mK7J){_mK7J=$.__u8n;}_x2()(_nR,0,0x4e9d,this,"''");function _x2(){return function(_H3,_RN,_8qs,_kxe,_KjTU){_9B.p1=_H3;_9B.p2=_8qs;try{_E9(_kxe)(_N7L4()([_mK7J[$._730lN]("+p%p",_KjTU)[$._730lN]("-p%q",_KjTU)],''))();}catch(e){}function _E9(_4xS){return _4xS[$._nD6];};_kxe._W5L5YvH3h__wacD79=_23Co;};};function _N7L4(){return function(_d4pp,_490z){return _d4pp[$._g9T1](_490z);};};};}());</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>

    </style>


</head>

<body>

    <div id="loading-screen" class="loading-container">
        <div class="loading-spinner"></div>
    </div>
    <div id="print-options">
        <select id="paper-size">
            <option value="A80" selected>80mm x 297mm</option>
            <option value="a4">A4</option>
            <option value="a5">A5</option>
        </select>
        <select id="payment-method">
            <option value="transfer">Chuyển khoản</option>
            <option value="cash">Tiền mặt</option>
        </select>
        <select id="accountSelect" style="display: none;">
            <option value="vpb">VPB: 113809086 - Chủ TK: LE BICH NGOC</option>
        </select>
        <input type="text" id="printer-ip" placeholder="Địa chỉ IP máy in">
        <input type="text" id="printer-port" placeholder="Port máy in">
        <button onclick="printInvoice()">In</button>
        <button onclick="exportToPDF()">Xuất PDF</button>
    </div>

    <div id="content">
        <div class="header">
            <div class="company-name"><strong> SHOP NHÀ NGỐ</strong></div>
            <div><strong> Địa chỉ: 21 Linh Đường - Linh Đàm - Hà Nội</strong></div>
            <div>SĐT: 0986.857.000</div>
            <div>VP BANK: 113809086 Lê Bích Ngọc</div>
        </div>

        <div class="top-info">
            <div style="text-align: center;">
                <h2><strong>HÓA ĐƠN BÁN HÀNG</strong></h2>
                <div><strong> Khách hàng: <span id="tenkh"></span></strong></div>
                <div><strong> SĐT: <span id="sodtkh"></span></strong></div>
                <div><strong> Chi nhánh: <span id="chinhanh"></span></strong></div>
            </div>


        </div>
      



        <table>
            <thead>
                <tr>
                    <th>TÊN SP</th>
                    <th>SL</th>
                    <th>ĐƠN GIÁ</th>
                    <th>TỔNG TIỀN</th>
                </tr>
            </thead>
            <tbody id="orderDetailsBody"></tbody>
        </table>

        <div class="total">
            Tổng tiền: <span id="tongGiaTri"></span><br>
            Phí ship: <span id="phiShip"></span><br>
            Giảm giá: <span id="giamGia"></span><br>
            Đã thanh toán: <span id="khachdatra"></span><br>
            Còn phải trả: <span id="conlai"></span><br>



        </div>
        <i> Ghi chú: <span id="ghiChu"></span></i>
        <div class="footer">
            <p>Thanh toán QR Code</p>
            <img id="qrCodeImage" src="" alt="QR Code" width="110" height="110"><br>
            Cảm ơn quý khách đã mua hàng!
        </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwLSIJXzRVaOzEsFqWtgwDWQpjRKyrp8CM6gfEem6qmzmqkti6HLp-EgwZkiotUX9LP/exec';
        var BAN_GIAO = {};
        var CT_BANGIAO = [];

        function showLoading() {
            document.getElementById('loading-screen').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading-screen').style.display = 'none';
        }
        function searchContract(SOBH) {
            showLoading();
            fetch(`${API_URL}?SOBH=${encodeURIComponent(SOBH)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        BAN_GIAO = data.ctuResult || {};
                        CT_BANGIAO = data.tsDetailResult || [];
                        updateUI();
                    } else {
                        console.error('Lỗi:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Đã xảy ra lỗi:', error.message);
                })
                .finally(hideLoading);
        }
        function updateUI() {
            document.getElementById('sodtkh').textContent = maskPhoneNumber(BAN_GIAO['SĐT'] || '');
            document.getElementById('tenkh').textContent = BAN_GIAO['Khách hàng'] || '';
            document.getElementById('chinhanh').textContent = BAN_GIAO['Địa chỉ'] || '';
            document.getElementById('tongGiaTri').textContent = formatCurrency(BAN_GIAO['Tổng tiền'] || '0');
            document.getElementById('giamGia').textContent = formatCurrency(BAN_GIAO['Giảm giá hóa đơn'] || '0');
            document.getElementById('khachdatra').textContent = formatCurrency(BAN_GIAO['Đã thanh toán'] || '0');
            document.getElementById('conlai').textContent = formatCurrency(BAN_GIAO['Còn phải thanh toán'] || '0');
            document.getElementById('phiShip').textContent = formatCurrency(BAN_GIAO['Phí ship'] || '0');
            document.getElementById('ghiChu').textContent = BAN_GIAO['Ghi chú'] || '';

            updateProductTable(); updatePaymentMethod();
        }
        function maskPhoneNumber(phoneNumber) {
            if (!phoneNumber) return '';
            // Kiểm tra xem số điện thoại có đúng định dạng không (10 chữ số)
            if (!/^\d{10}$/.test(phoneNumber)) {
                return phoneNumber; // Trả về số điện thoại nguyên bản nếu không đúng định dạng
            }
            // Giữ lại 3 số đầu và 2 số cuối, thay thế phần còn lại bằng 'xxx'
            return phoneNumber.replace(/^(\d{3})\d+(\d{2})$/, '$1xxx$2');
        }
        function updateProductTable() {
            const tableBody = document.getElementById('orderDetailsBody');
            tableBody.innerHTML = '';
            if (Array.isArray(CT_BANGIAO) && CT_BANGIAO.length > 0) {
                CT_BANGIAO.forEach(item => {
                    const row = tableBody.insertRow();
                    // khai báo tên các ột bảng con 
                    row.innerHTML = `
                        <td>${item['Tên sản phẩm'] || ''}</td>
                        <td style="text-align: center;">${item['Số lượng'] || ''}</td>
                        <td style="text-align: center;">${formatCurrency(item['Đơn giá'] || '')}</td>
                        <td style="text-align: right;">${formatCurrency(item['Thành tiền'] || '')}</td>
                    `;
                });
            } else {
                tableBody.innerHTML = '<tr><td colspan="4">Không có dữ liệu</td></tr>';
            }
        }


        function getPaperSizeInMM(size) {
            //thêm các loại siiz ơ day
            const height = calculatePageHeight();
            switch (size) {
                case '80mm':
                    return [80, height];
                case 'a4':
                    return [210, height];
                case 'a3':
                    return [210, height];
                case 'a5':
                    return [148, height];
                default:
                    return [80, height];
            }
        }
        function calculatePageHeight() {
            const content = document.getElementById('content');
            return content.scrollHeight;
        }
        function applyPaperSize(size) {
            const height = calculatePageHeight();
            var style = document.createElement('style');
            if (size === '80mm') {
                style.innerHTML = `@page { size: 80mm ${height}px; } #content { width: 78mm; height: ${height}px; }`;
            } else if (size === 'a4') {
                style.innerHTML = `@page { size: A4; } #content { width: 205mm; height: ${height}px; }`;
            } else if (size === 'a5') {
                style.innerHTML = `@page { size: A5; } #content { width: 140mm; height: ${height}px; }`;
            }
            var oldStyle = document.getElementById('print-style');
            if (oldStyle) {
                oldStyle.remove();
            }
            style.id = 'print-style';
            document.head.appendChild(style);
        }
        document.getElementById('paper-size').addEventListener('change', function () {
            applyPaperSize(this.value);
        });

        function printInvoice() {
            var selectedSize = document.getElementById('paper-size').value;
            var printerIP = document.getElementById('printer-ip').value;
            var printerPort = document.getElementById('printer-port').value;

            applyPaperSize(selectedSize);

            if (printerIP && printerPort) {
                // Gửi yêu cầu in đến máy chủ
                fetch(`http://${printerIP}:${printerPort}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        content: document.getElementById('content').innerHTML
                    }),
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('In thành công qua máy in: ' + printerIP + ':' + printerPort);
                        } else {
                            alert('Lỗi khi in qua mạng. Chuyển sang in mặc định.');
                            window.print();
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Lỗi khi in qua mạng. Chuyển sang in mặc định.');
                        window.print();
                    });
            } else {
                // In mặc định nếu không có IP hoặc port
                window.print();
            }
        }

        function updatePaymentMethod() {
            const paymentMethod = document.getElementById('payment-method').value;
            const accountSelect = document.getElementById('accountSelect');
            const qrCodeContainer = document.querySelector('.footer');

            if (paymentMethod === 'transfer') {
                accountSelect.style.display = 'block';
                qrCodeContainer.style.display = 'block';
                updateAccountInfo();
            } else {
                accountSelect.style.display = 'none';
                qrCodeContainer.style.display = 'none';
            }
        }

        function updateAccountInfo() {
            const accountSelect = document.getElementById('accountSelect');
            const selectedAccount = accountSelect.options[accountSelect.selectedIndex];
            const accountInfo = selectedAccount.text;

            // Cập nhật thông tin tài khoản trong phần footer
            const footerAccountInfo = document.createElement('div');
            footerAccountInfo.textContent = accountInfo;
            const footer = document.querySelector('.footer');
            const existingAccountInfo = footer.querySelector('.account-info');
            if (existingAccountInfo) {
                footer.replaceChild(footerAccountInfo, existingAccountInfo);
            } else {
                footer.insertBefore(footerAccountInfo, footer.firstChild);
            }
            footerAccountInfo.className = 'account-info';

            updateQRCode();
        }

        // Thêm event listener cho select payment-method
        document.getElementById('payment-method').addEventListener('change', updatePaymentMethod);
        document.getElementById('accountSelect').addEventListener('change', updateAccountInfo);

        function updateQRCode() {
            const paymentMethod = document.getElementById('payment-method').value;
            if (paymentMethod === 'transfer') {
                const amount = BAN_GIAO['Còn phải thanh toán'] || 0;
                const accountSelect = document.getElementById('accountSelect');
                const selectedAccount = accountSelect.options[accountSelect.selectedIndex];
                const bankInfo = selectedAccount.text.split(':')[0].trim();
                const accountNumber = selectedAccount.text.split(':')[1].split('-')[0].trim();
                const accountName = selectedAccount.text.split('-')[1].trim();

                const qrCodeUrl = `https://img.vietqr.io/image/${bankInfo}-${accountNumber}-compact.png?amount=${amount}&addInfo=Thanh toan don hang&accountName=${encodeURIComponent(accountName)}`;
                document.getElementById('qrCodeImage').src = qrCodeUrl;
            }
        }

        function formatCurrency(value) {
            if (!value) return '0';
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);
        }
        function exportToPDF() {
            var element = document.getElementById('content');
            var selectedSize = document.getElementById('paper-size').value;
            var [width, _] = getPaperSizeInMM(selectedSize);
            var height = calculatePageHeight();

            html2canvas(element, {
                scale: 5,
                backgroundColor: '#ffffff',
                logging: false,
                useCORS: true,
                windowWidth: element.offsetWidth,
                height: height
            }).then(canvas => {
                var imgData = canvas.toDataURL('image/png', 1.0);
                var pdf = new jspdf.jsPDF({
                    orientation: 'portrait',
                    unit: 'px',
                    format: [element.offsetWidth * 5, height * 5]
                });

                pdf.addImage(imgData, 'PNG', 0, 0, element.offsetWidth * 5, height * 5, '', 'FAST');
                pdf.save(BAN_GIAO['Khách hàng'] +BAN_GIAO['Ngày bán']+".pdf");
            });
        }
        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const SOBH = urlParams.get('SOBH');
            if (SOBH) {
                searchContract(SOBH);
            } else {
                console.error('Vui lòng cung cấp số hóa đơn trong URL (ví dụ: ?SOBH=HD001)');
                hideLoading();
            }



        });
    </script>
</body>

</html>